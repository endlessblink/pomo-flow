<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Context Menu Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }

        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .test-task {
            padding: 15px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            background: #fafafa;
            transition: background 0.2s;
        }

        .test-task:hover {
            background: #f0f0f0;
        }

        .context-menu {
            position: fixed;
            background: white;
            border: 1px solid #ccc;
            border-radius: 6px;
            padding: 8px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            min-width: 200px;
            display: none;
        }

        .menu-item {
            padding: 10px 16px;
            cursor: pointer;
            font-size: 14px;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
        }

        .menu-item:hover {
            background: #f0f0f0;
        }

        .log {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }

        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }

        .test-button:hover {
            background: #0056b3;
        }

        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Context Menu Functionality Test</h1>
        <p>This page tests the context menu functionality that was fixed in AllTasksView.vue</p>

        <div class="test-controls">
            <button class="test-button" onclick="createTestTasks()">Create Test Tasks</button>
            <button class="test-button" onclick="clearTasks()">Clear Tasks</button>
            <button class="test-button" onclick="testProgrammaticContext()">Test Programmatic Context Menu</button>
        </div>

        <div id="taskContainer">
            <p style="color: #666; font-style: italic;">Click "Create Test Tasks" to begin testing</p>
        </div>

        <div class="context-menu" id="contextMenu">
            <button class="menu-item" onclick="handleMenuAction('edit')">‚úèÔ∏è Edit Task</button>
            <button class="menu-item" onclick="handleMenuAction('duplicate')">üìã Duplicate Task</button>
            <button class="menu-item" onclick="handleMenuAction('delete')">üóëÔ∏è Delete Task</button>
        </div>

        <div class="log" id="log">
            <div class="info">Test log initialized. Ready to test context menu functionality.</div>
        </div>
    </div>

    <script>
        let taskCounter = 0;
        let currentTask = null;

        function log(message, type = 'info') {
            const logEl = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = type;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logEl.appendChild(logEntry);
            logEl.scrollTop = logEl.scrollHeight;
        }

        function createTestTasks() {
            const container = document.getElementById('taskContainer');
            container.innerHTML = '';

            const tasks = [
                { title: 'Test Parent Task 1', description: 'High priority task', priority: 'high' },
                { title: 'Test Parent Task 2', description: 'Medium priority task', priority: 'medium' },
                { title: 'Test Subtask', description: 'Low priority subtask', priority: 'low' },
                { title: 'In Progress Task', description: 'Currently working on this', priority: 'high' }
            ];

            tasks.forEach((taskData, index) => {
                const taskId = `task-${++taskCounter}`;
                const taskEl = document.createElement('div');
                taskEl.className = 'test-task';
                taskEl.dataset.taskId = taskId;
                taskEl.dataset.taskTitle = taskData.title;
                taskEl.dataset.taskPriority = taskData.priority;

                taskEl.innerHTML = `
                    <strong>${taskData.title}</strong><br>
                    <small>${taskData.description} (Priority: ${taskData.priority})</small>
                `;

                // Add context menu event listener
                taskEl.addEventListener('contextmenu', function(event) {
                    event.preventDefault();
                    handleContextMenu(event, {
                        id: taskId,
                        title: taskData.title,
                        description: taskData.description,
                        priority: taskData.priority
                    });
                });

                container.appendChild(taskEl);
                log(`Created task: ${taskData.title} (ID: ${taskId})`, 'success');
            });

            log(`Created ${tasks.length} test tasks. Right-click on any task to test context menu.`, 'info');
        }

        function clearTasks() {
            document.getElementById('taskContainer').innerHTML = '<p style="color: #666; font-style: italic;">Click "Create Test Tasks" to begin testing</p>';
            log('Cleared all tasks', 'info');
        }

        function handleContextMenu(event, task) {
            try {
                log(`Context menu triggered for task: ${task.title}`, 'info');
                log(`Event properties - clientX: ${event.clientX}, clientY: ${event.clientY}`, 'info');
                log(`Event type: ${event.type}, button: ${event.button}`, 'info');

                currentTask = task;

                const contextMenu = document.getElementById('contextMenu');
                contextMenu.style.left = event.clientX + 'px';
                contextMenu.style.top = event.clientY + 'px';
                contextMenu.style.display = 'block';

                // Add click outside listener
                setTimeout(() => {
                    document.addEventListener('click', handleClickOutside);
                }, 100);

                log('Context menu displayed successfully', 'success');

            } catch (error) {
                log(`Error in handleContextMenu: ${error.message}`, 'error');
                console.error('Context menu error:', error);
            }
        }

        function handleClickOutside(event) {
            const contextMenu = document.getElementById('contextMenu');
            if (!contextMenu.contains(event.target)) {
                contextMenu.style.display = 'none';
                document.removeEventListener('click', handleClickOutside);
                log('Context menu closed (clicked outside)', 'info');
            }
        }

        function handleMenuAction(action) {
            if (!currentTask) return;

            log(`Context menu action: ${action} on task: ${currentTask.title}`, 'info');

            switch (action) {
                case 'edit':
                    log(`‚úèÔ∏è Edit functionality would open edit modal for: ${currentTask.title}`, 'success');
                    break;
                case 'duplicate':
                    log(`üìã Duplicate functionality would create copy of: ${currentTask.title}`, 'success');
                    break;
                case 'delete':
                    log(`üóëÔ∏è Delete functionality would remove: ${currentTask.title}`, 'success');
                    break;
            }

            document.getElementById('contextMenu').style.display = 'none';
            currentTask = null;
        }

        function testProgrammaticContext() {
            log('Testing programmatic context menu trigger...', 'info');

            const tasks = document.querySelectorAll('.test-task');
            if (tasks.length === 0) {
                log('No tasks found. Create test tasks first.', 'error');
                return;
            }

            const firstTask = tasks[0];
            const rect = firstTask.getBoundingClientRect();

            // Create a synthetic contextmenu event
            const event = new MouseEvent('contextmenu', {
                bubbles: true,
                cancelable: true,
                clientX: rect.left + 10,
                clientY: rect.top + 10,
                button: 2
            });

            firstTask.dispatchEvent(event);
            log('Programmatic context menu triggered', 'info');
        }

        // Initialize
        log('Context Menu Test Page loaded successfully', 'success');
        log('The original error was: "TypeError: can\'t access property \'clientX\', event is undefined"', 'info');
        log('This test verifies that the MouseEvent is properly passed to handleContextMenu function', 'info');
    </script>
</body>
</html>