<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Test Tasks to Pomo-Flow</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
        }
        button:hover {
            background: #0056b3;
        }
        .status {
            margin: 15px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Add Test Tasks to Pomo-Flow</h1>
        <p>This script will add test tasks to the IndexedDB used by the pomo-flow application.</p>

        <button onclick="addBlinkTestTasks()">Add Blink Test Tasks</button>
        <button onclick="addTestTasks()">Add All Test Tasks</button>
        <button onclick="clearAllTasks()">Clear All Tasks</button>
        <button onclick="checkTasks()">Check Existing Tasks</button>

        <div id="status"></div>
    </div>

    <script>
        function showStatus(message, type = 'info') {
            const statusEl = document.getElementById('status');
            statusEl.innerHTML = `<div class="${type}">${message}</div>`;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        async function openDatabase() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('pomo-flow-db', 1);

                request.onerror = () => reject(request.error);
                request.onsuccess = () => resolve(request.result);

                request.onupgradeneeded = (event) => {
                    const db = event.target.result;

                    // Create object stores if they don't exist
                    if (!db.objectStoreNames.contains('tasks')) {
                        db.createObjectStore('tasks', { keyPath: 'id' });
                    }
                    if (!db.objectStoreNames.contains('projects')) {
                        db.createObjectStore('projects', { keyPath: 'id' });
                    }
                    if (!db.objectStoreNames.contains('settings')) {
                        db.createObjectStore('settings', { keyPath: 'key' });
                    }
                };
            });
        }

        async function addBlinkTestTasks() {
            try {
                showStatus('Opening database...', 'info');
                const db = await openDatabase();

                const transaction = db.transaction(['tasks', 'projects'], 'readwrite');
                const tasksStore = transaction.objectStore('tasks');
                const projectsStore = transaction.objectStore('projects');

                // Add default project if it doesn't exist
                const defaultProject = {
                    id: '1',
                    name: 'My Tasks',
                    color: '#3b82f6',
                    colorType: 'hex',
                    viewType: 'status',
                    createdAt: new Date()
                };

                projectsStore.put(defaultProject);

                // Create blink test tasks
                const blinkTestTasks = [
                    {
                        id: 'blink-task-1',
                        title: 'Blink Task 1 - Should be visible',
                        description: 'This is a test blink task to check if blink filter works',
                        status: 'todo',
                        priority: 'high',
                        progress: 0,
                        completedPomodoros: 0,
                        subtasks: [],
                        dueDate: new Date().toLocaleDateString(),
                        projectId: '1',
                        createdAt: new Date(),
                        updatedAt: new Date(),
                        isInInbox: true
                    },
                    {
                        id: 'blink-task-2',
                        title: 'Blink Task 2 - In Progress',
                        description: 'This blink task is in progress',
                        status: 'in_progress',
                        priority: 'medium',
                        progress: 50,
                        completedPomodoros: 1,
                        subtasks: [],
                        dueDate: new Date(Date.now() + 86400000).toLocaleDateString(),
                        projectId: '1',
                        createdAt: new Date(),
                        updatedAt: new Date(),
                        isInInbox: false,
                        canvasPosition: { x: 150, y: 250 }
                    }
                ];

                let addedCount = 0;
                for (const task of blinkTestTasks) {
                    tasksStore.put(task);
                    addedCount++;
                }

                transaction.oncomplete = () => {
                    showStatus(`Successfully added ${addedCount} blink test tasks!`, 'success');
                    console.log('Added blink tasks:', blinkTestTasks.map(t => t.title));
                };

                transaction.onerror = () => {
                    showStatus(`Error adding blink tasks: ${transaction.error}`, 'error');
                };

            } catch (error) {
                showStatus(`Database error: ${error.message}`, 'error');
                console.error('Database error:', error);
            }
        }

        async function addTestTasks() {
            try {
                showStatus('Opening database...', 'info');
                const db = await openDatabase();

                const transaction = db.transaction(['tasks', 'projects'], 'readwrite');
                const tasksStore = transaction.objectStore('tasks');
                const projectsStore = transaction.objectStore('projects');

                // Add default project if it doesn't exist
                const defaultProject = {
                    id: '1',
                    name: 'My Tasks',
                    color: '#3b82f6',
                    colorType: 'hex',
                    viewType: 'status',
                    createdAt: new Date()
                };

                projectsStore.put(defaultProject);

                // Create test tasks
                const testTasks = [
                    {
                        id: 'test-task-1',
                        title: 'Blink Task - Test Task for Filter',
                        description: 'This is a test task with blink in the title to test filtering',
                        status: 'todo',
                        priority: 'high',
                        progress: 0,
                        completedPomodoros: 0,
                        subtasks: [],
                        dueDate: new Date().toLocaleDateString(),
                        projectId: '1',
                        createdAt: new Date(),
                        updatedAt: new Date(),
                        isInInbox: true
                    },
                    {
                        id: 'test-task-2',
                        title: 'Another Blink Test Task',
                        description: 'This is another blink task for testing',
                        status: 'in_progress',
                        priority: 'medium',
                        progress: 35,
                        completedPomodoros: 2,
                        subtasks: [],
                        dueDate: new Date(Date.now() + 86400000).toLocaleDateString(), // Tomorrow
                        projectId: '1',
                        createdAt: new Date(),
                        updatedAt: new Date(),
                        isInInbox: false,
                        canvasPosition: { x: 100, y: 200 }
                    },
                    {
                        id: 'test-task-3',
                        title: 'Test Completed Task',
                        description: 'This task is already completed',
                        status: 'done',
                        priority: 'low',
                        progress: 100,
                        completedPomodoros: 4,
                        subtasks: [],
                        dueDate: new Date(Date.now() - 86400000).toLocaleDateString(), // Yesterday
                        projectId: '1',
                        createdAt: new Date(Date.now() - 172800000), // 2 days ago
                        updatedAt: new Date(),
                        isInInbox: false,
                        canvasPosition: { x: 300, y: 150 }
                    },
                    {
                        id: 'test-task-4',
                        title: 'Test Task with Subtasks',
                        description: 'This task has subtasks',
                        status: 'todo',
                        priority: 'high',
                        progress: 25,
                        completedPomodoros: 1,
                        subtasks: [
                            {
                                id: 'subtask-1',
                                parentTaskId: 'test-task-4',
                                title: 'First Subtask',
                                description: 'Complete the first part',
                                completedPomodoros: 1,
                                isCompleted: true,
                                createdAt: new Date(),
                                updatedAt: new Date()
                            },
                            {
                                id: 'subtask-2',
                                parentTaskId: 'test-task-4',
                                title: 'Second Subtask',
                                description: 'Complete the second part',
                                completedPomodoros: 0,
                                isCompleted: false,
                                createdAt: new Date(),
                                updatedAt: new Date()
                            }
                        ],
                        dueDate: new Date(Date.now() + 172800000).toLocaleDateString(), // Day after tomorrow
                        projectId: '1',
                        createdAt: new Date(),
                        updatedAt: new Date(),
                        isInInbox: true
                    }
                ];

                let addedCount = 0;
                for (const task of testTasks) {
                    tasksStore.put(task);
                    addedCount++;
                }

                transaction.oncomplete = () => {
                    showStatus(`Successfully added ${addedCount} test tasks and default project to database!`, 'success');
                    console.log('Added tasks:', testTasks.map(t => t.title));
                };

                transaction.onerror = () => {
                    showStatus(`Error adding tasks: ${transaction.error}`, 'error');
                };

            } catch (error) {
                showStatus(`Database error: ${error.message}`, 'error');
                console.error('Database error:', error);
            }
        }

        async function clearAllTasks() {
            try {
                showStatus('Clearing all tasks...', 'info');
                const db = await openDatabase();

                const transaction = db.transaction(['tasks'], 'readwrite');
                const tasksStore = transaction.objectStore('tasks');

                const clearRequest = tasksStore.clear();

                clearRequest.onsuccess = () => {
                    showStatus('All tasks cleared successfully!', 'success');
                };

                clearRequest.onerror = () => {
                    showStatus(`Error clearing tasks: ${clearRequest.error}`, 'error');
                };

            } catch (error) {
                showStatus(`Database error: ${error.message}`, 'error');
            }
        }

        async function checkTasks() {
            try {
                showStatus('Checking existing tasks...', 'info');
                const db = await openDatabase();

                const transaction = db.transaction(['tasks'], 'readonly');
                const tasksStore = transaction.objectStore('tasks');

                const getRequest = tasksStore.getAll();

                getRequest.onsuccess = () => {
                    const tasks = getRequest.result;
                    if (tasks.length === 0) {
                        showStatus('No tasks found in database. Click "Add Test Tasks" to create some.', 'info');
                    } else {
                        let taskList = tasks.map(task =>
                            `â€¢ ${task.title} (${task.status}, ${task.priority || 'no priority'})`
                        ).join('\n');
                        showStatus(`Found ${tasks.length} tasks:\n${taskList}`, 'success');
                    }
                    console.log('Existing tasks:', tasks);
                };

                getRequest.onerror = () => {
                    showStatus(`Error checking tasks: ${getRequest.error}`, 'error');
                };

            } catch (error) {
                showStatus(`Database error: ${error.message}`, 'error');
            }
        }

        // Check tasks on page load
        window.onload = () => {
            checkTasks();
        };
    </script>
</body>
</html>